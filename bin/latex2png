#!/bin/sh

# todo: add caching

HASH=$(echo $1 | 9 md5sum)

cat << EOF | latex -jobname=$HASH -- > /dev/null 2>&1
\documentclass[11pt]{article}
\pagestyle{empty}
\usepackage{amsmath}
\begin{document}
$1
\end{document}
EOF

dvipng -T tight -D 120 $HASH.dvi -o $HASH.png > /dev/null 2>&1
optipng $HASH.png > /dev/null 2>&1
rm $HASH.aux $HASH.log $HASH.dvi
echo -n $(base64 $HASH.png)
rm $HASH.png
